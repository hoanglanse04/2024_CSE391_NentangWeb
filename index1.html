<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý sinh viên</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="container mx-auto p-4">

<h2 class="text-2xl font-bold mb-4">Quản lý sinh viên</h2>

<div class="mb-4">
    <label for="lop" class="block text-gray-700 text-sm font-bold mb-2">Chọn lớp:</label>
    <select id="lop" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
    </select>
</div>

<div class="mb-4">
    <button id="addStudent" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Thêm sinh viên</button>
</div>

<h3 class="text-xl font-bold mb-2">Danh sách sinh viên</h3>
<table id="bangSinhVien" class="table-auto w-full">
    <thead>
    <tr>
        <th class="px-4 py-2">Họ tên</th>
        <th class="px-4 py-2">Mã SV</th>
        <th class="px-4 py-2">Ngày sinh</th>
        <th class="px-4 py-2">Hành động</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<!-- Modal for adding/editing student -->
<div id="formSinhVienModal" class="hidden fixed z-10 inset-0 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
  <div class="flex items-center justify-center min-h-screen">
    <div class="bg-white rounded-lg overflow-hidden shadow-xl transform transition-all sm:max-w-lg sm:w-full">
      <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
        <div class="sm:flex sm:items-start">
          <div class="mt-3 text-center sm:mt-0 sm:text-left">
            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Thêm/Sửa Sinh Viên</h3>
            <div class="mt-2">
              <form id="formSinhVien">
                <div class="mb-4">
                  <label for="hoTen" class="block text-gray-700 text-sm font-bold mb-2">Họ tên:</label>
                  <input type="text" id="hoTen" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div class="mb-4">
                  <label for="maSV" class="block text-gray-700 text-sm font-bold mb-2">Mã SV:</label>
                  <input type="text" id="maSV" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div class="mb-4">
                  <label for="ngaySinh" class="block text-gray-700 text-sm font-bold mb-2">Ngày sinh:</label>
                  <input type="date" id="ngaySinh" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div class="flex items-center justify-between">
                  <button type="button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" id="saveStudent">Lưu</button>
                  <button type="button" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" id="cancelStudent">Hủy</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  $(document).ready(function() {
    let studentsData = JSON.parse(localStorage.getItem('studentsData')) || [
      {
        "tenLop": "K64KTPM1",
        "sinhVien": [
          { "hoTen": "Nguyễn Văn A", "maSV": "123456", "ngaySinh": "2002-05-15" },
          { "hoTen": "Trần Thị B", "maSV": "654321", "ngaySinh": "2003-08-22" }
        ]
      },
      {
        "tenLop": "K64KTPM2",
        "sinhVien": [
          { "hoTen": "Lê Văn C", "maSV": "987654", "ngaySinh": "2002-12-10" },
          { "hoTen": "Phạm Thị D", "maSV": "456789", "ngaySinh": "2003-03-05" }
        ]
      }
    ];

    function saveDataToLocalStorage() {
      localStorage.setItem('studentsData', JSON.stringify(studentsData));
    }

    function loadClasses() {
      const lopSelect = $("#lop");
      lopSelect.empty();
      lopSelect.append('<option value="">Chọn lớp</option>');
      $.each(studentsData, function(index, lop) {
        lopSelect.append('<option value="' + index + '">' + lop.tenLop + '</option>');
      });
    }

    function loadStudents(selectedClassIndex) {
      const studentsList = studentsData[selectedClassIndex] ? studentsData[selectedClassIndex].sinhVien : [];
      const tbody = $("#bangSinhVien tbody");
      tbody.empty();

      $.each(studentsList, function(index, student) {
        tbody.append('<tr>' +
          '<td class="px-4 py-2">' + student.hoTen + '</td>' +
          '<td class="px-4 py-2">' + student.maSV + '</td>' +
          '<td class="px-4 py-2">' + student.ngaySinh + '</td>' +
          '<td class="px-4 py-2">' +
            '<button class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-1 px-2 rounded editStudent" data-class="' + selectedClassIndex + '" data-index="' + index + '">Sửa</button> ' +
            '<button class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded deleteStudent" data-class="' + selectedClassIndex + '" data-index="' + index + '">Xóa</button>' +
          '</td>' +
        '</tr>');
      });
    }

    loadClasses();

    $("#lop").change(function() {
      const selectedClassIndex = $(this).val();
      loadStudents(selectedClassIndex);
    });

    function showStudentModal(student) {
      $("#hoTen").val(student ? student.hoTen : '');
      $("#maSV").val(student ? student.maSV : '');
      $("#ngaySinh").val(student ? student.ngaySinh : '');
      $("#formSinhVienModal").removeClass('hidden');
    }

    function hideStudentModal() {
      $("#formSinhVienModal").addClass('hidden');
    }

    $("#saveStudent").click(function() {
      const selectedClassIndex = $("#lop").val();
      if (!selectedClassIndex) return;

      const hoTen = $("#hoTen").val();
      const maSV = $("#maSV").val();
      const ngaySinh = $("#ngaySinh").val();

      if (!hoTen || !maSV || !ngaySinh) {
        alert("Vui lòng nhập đầy đủ thông tin!");
        return;
      }

      const newStudent = { hoTen, maSV, ngaySinh };
      const index = $(this).data("index");

      if (index !== undefined) {
        studentsData[selectedClassIndex].sinhVien[index] = newStudent;
      } else {
        studentsData[selectedClassIndex].sinhVien.push(newStudent);
      }

      saveDataToLocalStorage();
      loadStudents(selectedClassIndex);
      hideStudentModal();
    });

    $("#cancelStudent").click(hideStudentModal);

    $(document).on("click", ".editStudent", function() {
      const selectedClassIndex = $(this).data("class");
      const index = $(this).data("index");
      const student = studentsData[selectedClassIndex].sinhVien[index];
      $("#saveStudent").data("index", index);
      showStudentModal(student);
    });

    $(document).on("click", ".deleteStudent", function() {
      if (confirm("Bạn có chắc chắn muốn xóa sinh viên này?")) {
        const selectedClassIndex = $(this).data("class");
        const index = $(this).data("index");
        studentsData[selectedClassIndex].sinhVien.splice(index, 1);
        saveDataToLocalStorage();
        loadStudents(selectedClassIndex);
      }
    });

    $("#addStudent").click(function() {
      $("#saveStudent").removeData("index");
      showStudentModal();
    });
  });
</script>

</body>
</html>
